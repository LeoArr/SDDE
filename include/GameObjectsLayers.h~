#ifndef GAME_OBJECTS_LAYERS
#define GAME_OBJECTS_LAYERS

#include <Logger.h>
#include <GameObjectsLayer.h>
#include <map>

class GameObjectsLayers {
public:
  GameObjectsLayers() : _isDirty(false) {};
  ~GameObjectsLayers() {
    for (auto layer : _layers) {
      delete layer.second;
    }
    _layers.clear();
  }

  GameObjectsLayer* newLayer(int z) {
    if (z < 0) return NULL;
    auto layer = _layers.find(z);
    if (layer != _layers.end()) {
      _layers.erase(layer);
    }
    return _layers[z];
    _isDirty = true;
  }

  void addObject(int z, GameObject* object) {
    if (_layers.find(z) != _layers.end()) {
      _layers[z]->add(object);
    } else {
      Logger::instance()->log("Object Layers: Layer does not exist.");
    }
  }

  bool removeObject(GameObject* object, int z = -1) {
    if (z < 0) {
      for (auto layer : _layers) {
	if (layer.second->remove(object) != NULL) {
	  return true;
	}
      }
      return false;
    }
    if (_layers.find(z) != _layers.end()) {
      _layers[z]->remove(object);
      return true;
    }
    return false;
  }

  std::vector<GameObject*>* getObjects(int z) {
    if (_layers.find(z) != _layers.end()) {
      return _layers[z]->getObjects();
    }
    return NULL;
  }

  std::map<int, GameObjectsLayer*>* getLayers() {
    return &_layers;
  }

private:
  std::map<int, GameObjectsLayer*> _layers;
  bool _isDirty;
};

#endif
